import { NextResponse } from "next/server"
import { searchDB } from "@/lib/db"

// 定义热门代币接口
export interface TrendingToken {
  id: string
  name: string
  symbol: string
  price: number
  priceUsd: string
  change24h: number
  volume24h: number
  volumeUsd: string
  marketCap: number
  marketCapUsd: string
  chainId: string
  chain: string
  address: string
  logo: string
  color: string
  rank: number
  trending: "up" | "down" | "neutral"
  searchCount?: number
}

// 获取热门代币列表
export async function GET() {
  try {
    // 模拟从API获取的热门代币数据
    const trendingTokens: TrendingToken[] = [
      {
        id: "bitcoin",
        name: "BTC",
        symbol: "Bitcoin",
        price: 62541.23,
        priceUsd: "$62,541.23",
        change24h: 0.62,
        volume24h: 24500000,
        volumeUsd: "$24.5M",
        marketCap: 1210000000000,
        marketCapUsd: "$1.21T",
        chainId: "1",
        chain: "ethereum",
        address: "0x2260fac5e5542a773aa44fbcfedf7c193bc2c599",
        logo: "https://assets.coingecko.com/coins/images/1/large/bitcoin.png",
        color: "#F7931A",
        rank: 1,
        trending: "up",
      },
      {
        id: "ethereum",
        name: "ETH",
        symbol: "Ethereum",
        price: 3458.92,
        priceUsd: "$3,458.92",
        change24h: 0.55,
        volume24h: 12300000000,
        volumeUsd: "$12.3B",
        marketCap: 415000000000,
        marketCapUsd: "$415B",
        chainId: "1",
        chain: "ethereum",
        address: "0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2",
        logo: "https://assets.coingecko.com/coins/images/279/large/ethereum.png",
        color: "#627EEA",
        rank: 2,
        trending: "up",
      },
      {
        id: "binancecoin",
        name: "BNB",
        symbol: "BNB",
        price: 598.47,
        priceUsd: "$598.47",
        change24h: 0.72,
        volume24h: 1450000000,
        volumeUsd: "$1.45B",
        marketCap: 92000000000,
        marketCapUsd: "$92B",
        chainId: "56",
        chain: "bsc",
        address: "0xbb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c",
        logo: "https://assets.coingecko.com/coins/images/825/large/bnb-icon2_2x.png",
        color: "#F3BA2F",
        rank: 3,
        trending: "up",
      },
      {
        id: "solana",
        name: "SOL",
        symbol: "Solana",
        price: 142.37,
        priceUsd: "$142.37",
        change24h: 0.83,
        volume24h: 2100000000,
        volumeUsd: "$2.1B",
        marketCap: 61500000000,
        marketCapUsd: "$61.5B",
        chainId: "solana",
        chain: "solana",
        address: "So11111111111111111111111111111111111111112",
        logo: "https://assets.coingecko.com/coins/images/4128/large/solana.png",
        color: "#00FFA3",
        rank: 4,
        trending: "up",
      },
      {
        id: "avalanche-2",
        name: "AVAX",
        symbol: "Avalanche",
        price: 36.52,
        priceUsd: "$36.52",
        change24h: -1.25,
        volume24h: 750000000,
        volumeUsd: "$750M",
        marketCap: 13200000000,
        marketCapUsd: "$13.2B",
        chainId: "43114",
        chain: "avalanche",
        address: "0xb31f66aa3c1e785363f0875a1b74e27b85fd66c7",
        logo: "https://assets.coingecko.com/coins/images/12559/large/Avalanche_Circle_RedWhite_Trans.png",
        color: "#E84142",
        rank: 5,
        trending: "down",
      },
      {
        id: "arbitrum",
        name: "ARB",
        symbol: "Arbitrum",
        price: 1.23,
        priceUsd: "$1.23",
        change24h: 2.45,
        volume24h: 320000000,
        volumeUsd: "$320M",
        marketCap: 3900000000,
        marketCapUsd: "$3.9B",
        chainId: "42161",
        chain: "arbitrum",
        address: "0x912ce59144191c1204e64559fe8253a0e49e6548",
        logo: "https://assets.coingecko.com/coins/images/16547/large/photo_2023-03-29_21.47.00.jpeg",
        color: "#2D374B",
        rank: 6,
        trending: "up",
      },
      {
        id: "optimism",
        name: "OP",
        symbol: "Optimism",
        price: 2.87,
        priceUsd: "$2.87",
        change24h: 1.32,
        volume24h: 280000000,
        volumeUsd: "$280M",
        marketCap: 2800000000,
        marketCapUsd: "$2.8B",
        chainId: "10",
        chain: "optimism",
        address: "0x4200000000000000000000000000000000000042",
        logo: "https://assets.coingecko.com/coins/images/25244/large/Optimism.png",
        color: "#FF0420",
        rank: 7,
        trending: "up",
      },
      {
        id: "polygon",
        name: "MATIC",
        symbol: "Polygon",
        price: 0.58,
        priceUsd: "$0.58",
        change24h: -0.75,
        volume24h: 410000000,
        volumeUsd: "$410M",
        marketCap: 5400000000,
        marketCapUsd: "$5.4B",
        chainId: "137",
        chain: "polygon",
        address: "0x0000000000000000000000000000000000001010",
        logo: "https://assets.coingecko.com/coins/images/4713/large/matic-token-icon.png",
        color: "#8247E5",
        rank: 8,
        trending: "down",
      },
      {
        id: "near",
        name: "NEAR",
        symbol: "NEAR Protocol",
        price: 5.92,
        priceUsd: "$5.92",
        change24h: 3.21,
        volume24h: 520000000,
        volumeUsd: "$520M",
        marketCap: 6100000000,
        marketCapUsd: "$6.1B",
        chainId: "near",
        chain: "near",
        address: "near",
        logo: "https://assets.coingecko.com/coins/images/10365/large/near.jpg",
        color: "#000000",
        rank: 9,
        trending: "up",
      },
      {
        id: "sui",
        name: "SUI",
        symbol: "Sui",
        price: 1.35,
        priceUsd: "$1.35",
        change24h: 5.67,
        volume24h: 630000000,
        volumeUsd: "$630M",
        marketCap: 2700000000,
        marketCapUsd: "$2.7B",
        chainId: "sui",
        chain: "sui",
        address: "sui",
        logo: "https://assets.coingecko.com/coins/images/26375/large/sui_asset.jpeg",
        color: "#6FBCF0",
        rank: 10,
        trending: "up",
      },
    ]

    // 获取新上线的代币
    const newListings: TrendingToken[] = [
      {
        id: "jupiter",
        name: "JUP",
        symbol: "Jupiter",
        price: 0.82,
        priceUsd: "$0.82",
        change24h: 12.5,
        volume24h: 180000000,
        volumeUsd: "$180M",
        marketCap: 1100000000,
        marketCapUsd: "$1.1B",
        chainId: "solana",
        chain: "solana",
        address: "JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN",
        logo: "https://assets.coingecko.com/coins/images/34417/large/jup.png",
        color: "#5D5FEF",
        rank: 1,
        trending: "up",
      },
      {
        id: "pyth-network",
        name: "PYTH",
        symbol: "Pyth Network",
        price: 0.45,
        priceUsd: "$0.45",
        change24h: 8.3,
        volume24h: 95000000,
        volumeUsd: "$95M",
        marketCap: 750000000,
        marketCapUsd: "$750M",
        chainId: "solana",
        chain: "solana",
        address: "HZ1JovNiVvGrGNiiYvEozEVgZ58xaU3RKwX8eACQBCt3",
        logo: "https://assets.coingecko.com/coins/images/28284/large/pyth_logo.jpg",
        color: "#7C41DA",
        rank: 2,
        trending: "up",
      },
      {
        id: "bonk",
        name: "BONK",
        symbol: "Bonk",
        price: 0.00002,
        priceUsd: "$0.00002",
        change24h: 15.2,
        volume24h: 120000000,
        volumeUsd: "$120M",
        marketCap: 1200000000,
        marketCapUsd: "$1.2B",
        chainId: "solana",
        chain: "solana",
        address: "DezXAZ8z7PnrnRJjz3wXBoRgixCa6xjnB7YaB1pPB263",
        logo: "https://assets.coingecko.com/coins/images/28600/large/bonk.jpg",
        color: "#FFC431",
        rank: 3,
        trending: "up",
      },
    ]

    // 获取高交易量代币
    const highVolumeTokens: TrendingToken[] = [
      {
        id: "uniswap",
        name: "UNI",
        symbol: "Uniswap",
        price: 10.25,
        priceUsd: "$10.25",
        change24h: 1.8,
        volume24h: 850000000,
        volumeUsd: "$850M",
        marketCap: 7800000000,
        marketCapUsd: "$7.8B",
        chainId: "1",
        chain: "ethereum",
        address: "0x1f9840a85d5af5bf1d1762f925bdaddc4201f984",
        logo: "https://assets.coingecko.com/coins/images/12504/large/uni.jpg",
        color: "#FF007A",
        rank: 1,
        trending: "up",
      },
      {
        id: "aave",
        name: "AAVE",
        symbol: "Aave",
        price: 92.35,
        priceUsd: "$92.35",
        change24h: 2.1,
        volume24h: 320000000,
        volumeUsd: "$320M",
        marketCap: 1350000000,
        marketCapUsd: "$1.35B",
        chainId: "1",
        chain: "ethereum",
        address: "0x7fc66500c84a76ad7e9c93437bfc5ac33e2ddae9",
        logo: "https://assets.coingecko.com/coins/images/12645/large/AAVE.png",
        color: "#B6509E",
        rank: 2,
        trending: "up",
      },
      {
        id: "compound-governance-token",
        name: "COMP",
        symbol: "Compound",
        price: 63.42,
        priceUsd: "$63.42",
        change24h: -1.2,
        volume24h: 180000000,
        volumeUsd: "$180M",
        marketCap: 510000000,
        marketCapUsd: "$510M",
        chainId: "1",
        chain: "ethereum",
        address: "0xc00e94cb662c3520282e6f5717214004a7f26888",
        logo: "https://assets.coingecko.com/coins/images/10775/large/COMP.png",
        color: "#00D395",
        rank: 3,
        trending: "down",
      },
    ]

    // 确保返回正确的 Content-Type 头
    return NextResponse.json(
      {
        success: true,
        data: {
          trending: trendingTokens,
          newListings: newListings,
          highVolume: highVolumeTokens,
          lastUpdated: new Date().toISOString(),
        },
      },
      {
        headers: {
          "Content-Type": "application/json",
        },
      },
    )
  } catch (error) {
    console.error("Error fetching trending tokens:", error)

    // 确保错误响应也是 JSON 格式
    return NextResponse.json(
      {
        success: false,
        error: "Failed to fetch trending tokens",
        message: error instanceof Error ? error.message : "Unknown error",
      },
      {
        status: 500,
        headers: {
          "Content-Type": "application/json",
        },
      },
    )
  }
}
